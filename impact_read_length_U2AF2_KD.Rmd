---
title: "The impact of read length on the description of alternative splicing events in RNA-Seq data"
author: "Annika Ladwig"
output:
  prettydoc::html_pretty:
    theme: architect
---

```{r, echo=FALSE, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# LIBRARIES 
library(dplyr)
library(ggplot2)
library(stringr)
library(ggpubr)
library("RColorBrewer")
library("ggVennDiagram")
library("wesanderson")
library("colorspace")
library(UpSetR)
library(ggforce)
library(ggpointdensity)
library(viridis)

# MY PARAMETERS
probabilityThreshold = 0.9

# MY THEME
source("C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/theme_paper.R")
theme_set(theme_paper())

# MY FUNCTIONS
# function to extract relevant rows and columns
createTable <- function(file) {
  file = file[-1] %>%
    slice(7, 24, 27, 29, 31) %>%
    rename(n = 1)
  file = cbind(Reads = c("01 uniquely mapped", "02 multiple mapped", "03 unmapped 1", "04 unmapped 2", "05 unmapped 3"), file)
  file[nrow(file) + 1,] = c("03 unmapped", sum(c(as.numeric(file[3:5, 2]))))
  file = file %>% slice(1, 2, 6)
}

# function to load files as data frames
loadFiles <- function(x){
  x = read.table(file = x,
                 header = TRUE,
                 sep = "\t",
                 stringsAsFactors = FALSE)
}

# function to count semicolons of column "mean_dpsi_per_lsv_junction"
# to find out the number of junctions per LSV
# store this information in new column "nJunctions"
countJunctions <- function(x) {
  SRSF6_junctionsPerLSV = x$mean_dpsi_per_lsv_junction %>%
   str_count(pattern = ";") + 1
  x$nJunctions = SRSF6_junctionsPerLSV
  x
}

# count the amount of LSVs with 2, 3, 4, ... junctions
# create data frame with this information
complexityLSVs <- function(x) {
   junctionsPerLSV = x$nJunctions %>%
    table(dnn="junctionsPerLSV") %>%
    as.data.frame
   junctionsPerLSV
}

# function to extract max. dPSI for each LSV and add new column with this information
extractMaxDPSIs <- function(x) {
  maxDeltaPSIs = x$mean_dpsi_per_lsv_junction %>%
    str_split(pattern = ";") %>%
    sapply(FUN = function(dPSIs){
      return(
        dPSIs %>% as.numeric %>% abs %>% max
      )
    })
  x$maxDeltaPSI = maxDeltaPSIs
  x
}

# function to extract max. probability for each LSV and add new column with this information
extractMaxProbs <- function(x) {
  maxProbs = x$probability_changing %>%
    str_split(pattern=";") %>%
    sapply(FUN=function(probs){
      return(
        probs %>% as.numeric %>% max
      )
    })
  x$maxProb = maxProbs
  x
}
```

# Influence on read alignment (U2AF2)
```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# load star log files 
U2AF2_StarDir = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/U2AF2/STAR"

U2AF2_StarLogFiles=list.files(path=U2AF2_StarDir)
setwd(U2AF2_StarDir)

U2AF2_StarLogFiles = lapply(U2AF2_StarLogFiles, read.delim)


# number of input reads for each replicate
for(file in seq(1, 16, 4)){
  print(U2AF2_StarLogFiles[[file]][4,2])
}


# apply createTable to list with star log files
U2AF2_StarLogFiles = lapply(U2AF2_StarLogFiles, createTable)


# add new column with read length to the tables to differ the data
# when merging them into a common table 
for(i in seq(1, 16, 4)){
  U2AF2_StarLogFiles[[i]]$readLength = "100"
}
for(i in seq(2, 16, 4)){
  U2AF2_StarLogFiles[[i]]$readLength = "075"
}
for(i in seq(3, 16, 4)){
  U2AF2_StarLogFiles[[i]]$readLength = "050"
}
for(i in seq(4, 16, 4)){
  U2AF2_StarLogFiles[[i]]$readLength = "025"
}


# create one table for each experiment for different read lengths
U2AF2_StarLogTable_1 = rbind(U2AF2_StarLogFiles[[1]], U2AF2_StarLogFiles[[2]], U2AF2_StarLogFiles[[3]], U2AF2_StarLogFiles[[4]])

U2AF2_StarLogTable_2 = rbind(U2AF2_StarLogFiles[[5]], U2AF2_StarLogFiles[[6]], U2AF2_StarLogFiles[[7]], U2AF2_StarLogFiles[[8]])

U2AF2_StarLogTable_3 = rbind(U2AF2_StarLogFiles[[9]], U2AF2_StarLogFiles[[10]], U2AF2_StarLogFiles[[11]], U2AF2_StarLogFiles[[12]])

U2AF2_StarLogTable_4 = rbind(U2AF2_StarLogFiles[[13]], U2AF2_StarLogFiles[[14]], U2AF2_StarLogFiles[[15]], U2AF2_StarLogFiles[[16]])


# plot relevant star log output as stacked bar chart for each experiment
U2AF2_StarReport_StackedBarChart = ggarrange(
  ggplot(U2AF2_StarLogTable_1, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("knockdown 1") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  ggplot(U2AF2_StarLogTable_2, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("control 1") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  ggplot(U2AF2_StarLogTable_3, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("knockdown 2") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  ggplot(U2AF2_StarLogTable_4, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("control 2") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  common.legend = TRUE, legend = "bottom",
  ncol = 4, nrow = 1
  
  )

U2AF2_StarReport_StackedBarChart = annotate_figure(U2AF2_StarReport_StackedBarChart, top = text_grob("D U2AF2", size = 12, just = "centre", face = "bold"))
U2AF2_StarReport_StackedBarChart

# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/U2AF2_mapping.pdf", plot = U2AF2_StarReport_StackedBarChart, width = 12, height = 6, units = "cm")
```
# Influence on read alignment (UPF1)
```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# load star log files 
UPF1_StarDir = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/UPF1/STAR"

UPF1_StarLogFiles=list.files(path=UPF1_StarDir)
setwd(UPF1_StarDir)

UPF1_StarLogFiles = lapply(UPF1_StarLogFiles, read.delim)


# number of input reads for each replicate
for(file in seq(1, 16, 4)){
  print(UPF1_StarLogFiles[[file]][4,2])
}


# apply createTable to list with star log files
UPF1_StarLogFiles = lapply(UPF1_StarLogFiles, createTable)


# add new column with read length to the tables to differ the data
# when merging them into a common table 
for(i in seq(1, 16, 4)){
  UPF1_StarLogFiles[[i]]$readLength = "100"
}
for(i in seq(2, 16, 4)){
  UPF1_StarLogFiles[[i]]$readLength = "075"
}
for(i in seq(3, 16, 4)){
  UPF1_StarLogFiles[[i]]$readLength = "050"
}
for(i in seq(4, 16, 4)){
  UPF1_StarLogFiles[[i]]$readLength = "025"
}


# create one table for each experiment for different read lengths
UPF1_StarLogTable_1 = rbind(UPF1_StarLogFiles[[1]], UPF1_StarLogFiles[[2]], UPF1_StarLogFiles[[3]], UPF1_StarLogFiles[[4]])

UPF1_StarLogTable_2 = rbind(UPF1_StarLogFiles[[5]], UPF1_StarLogFiles[[6]], UPF1_StarLogFiles[[7]], UPF1_StarLogFiles[[8]])

UPF1_StarLogTable_3 = rbind(UPF1_StarLogFiles[[9]], UPF1_StarLogFiles[[10]], UPF1_StarLogFiles[[11]], UPF1_StarLogFiles[[12]])

UPF1_StarLogTable_4 = rbind(UPF1_StarLogFiles[[13]], UPF1_StarLogFiles[[14]], UPF1_StarLogFiles[[15]], UPF1_StarLogFiles[[16]])


# plot relevant star log output as stacked bar chart for each experiment
UPF1_StarReport_StackedBarChart = ggarrange(
  ggplot(UPF1_StarLogTable_1, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("KD 1") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  ggplot(UPF1_StarLogTable_2, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("CT 1") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  ggplot(UPF1_StarLogTable_3, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("KD 2") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("KD 2") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  ggplot(UPF1_StarLogTable_4, aes(x = readLength, y = as.numeric(n), fill = Reads)) +
    geom_col(position = position_fill(reverse = TRUE)) +
    xlab("read length [nt]") +
    ylab("% reads") +
    scale_x_discrete(labels = c("36", "50", "75", "100")) +
    ggtitle("CT 2") +
    theme(legend.title = element_blank()) +
    scale_fill_manual(values = wes_palette("GrandBudapest1")),
  
  common.legend = TRUE, legend = "bottom",
  ncol = 4, nrow = 1
  
  )


UPF1_StarReport_StackedBarChart = annotate_figure(UPF1_StarReport_StackedBarChart, top = text_grob("D UPF1", size = 12, just = "centre", face = "bold"))
UPF1_StarReport_StackedBarChart


# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/UPF1_mapping.pdf", plot = UPF1_StarReport_StackedBarChart, width = 12, height = 6, units = "cm")
```


```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
# U2AF2
# load dPSI tsv files from MAJIQ Quantifier as list
U2AF2_dpsiDir = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/U2AF2/MAJIQ/read_length"

U2AF2_dpsiFiles=list.files(path = U2AF2_dpsiDir, pattern = ".tsv")
setwd(U2AF2_dpsiDir)

# load tsv files as data frames
# & name list elements
U2AF2_dPSIs = lapply(U2AF2_dpsiFiles, loadFiles)
#names(U2AF2_dPSIs) = c("dpsi_36", "dpsi_50", "dpsi_75", "dpsi_100")

# UPF1
# load dpsi tsv files from MAJIQ Quantifier as list
UPF1_dpsiDir = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/UPF1/MAJIQ"

UPF1_dpsiFiles=list.files(path = UPF1_dpsiDir, pattern = ".tsv")
setwd(UPF1_dpsiDir)

# load dpsi tsv files as data frames
# & name list elements
UPF1_dPSIs = lapply(UPF1_dpsiFiles, loadFiles)
#names(UPF1_dPSIs) = c("dpsi_36", "dpsi_50", "dpsi_75", "dpsi_100")

```

# Influence on LSV detection (U2AF2)
```{r}
# detected LSVs
U2AF2_nLSVs_readLength_36 = nrow(U2AF2_dPSIs[[1]])
U2AF2_nLSVs_readLength_50 = nrow(U2AF2_dPSIs[[2]])
U2AF2_nLSVs_readLength_75 = nrow(U2AF2_dPSIs[[3]])
U2AF2_nLSVs_readLength_100 = nrow(U2AF2_dPSIs[[4]])

cat("number of LSVs from read length 36 to 100", fill = TRUE)
U2AF2_nLSVs_readLength_36
U2AF2_nLSVs_readLength_50
U2AF2_nLSVs_readLength_75
U2AF2_nLSVs_readLength_100

# create dataframe with nLSVs 
U2AF2_nLSVs_df = data.frame(readLength=c("036", "050", "075", "100"),
                      nLSVs=c(U2AF2_nLSVs_readLength_36, U2AF2_nLSVs_readLength_50, U2AF2_nLSVs_readLength_75, U2AF2_nLSVs_readLength_100))

# number of LSVs bar chart
U2AF2_nLSVs_bar = ggplot(data=U2AF2_nLSVs_df, aes(x = readLength, y = nLSVs, fill = readLength)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  ylim(0, 50500) +
  xlab("read length [nt]") +
  ylab("# LSVs") +
  ggtitle("A") +
  scale_fill_manual(name = "read length [nt]", values = c("#FAD8B4", "#F7B56D", "#DE872A", "#C85813"),  
                    labels = c("36", "50", "75", "100")) +
  scale_x_discrete(labels = c("36", "50", "75", "100")) +
  geom_text(aes(label=nLSVs), position=position_dodge(width=0.9), vjust=-0.25) 

U2AF2_nLSVs_bar

# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/U2AF2_nLSVs_bar.pdf", plot = U2AF2_nLSVs_bar, width = 3.18, height = 6, units = "cm")
```
# Influence on LSV detection (UPF1)
```{r}
# detected LSVs
UPF1_nLSVs_readLength_36 = nrow(UPF1_dPSIs[[1]])
UPF1_nLSVs_readLength_50 = nrow(UPF1_dPSIs[[2]])
UPF1_nLSVs_readLength_75 = nrow(UPF1_dPSIs[[3]])
UPF1_nLSVs_readLength_100 = nrow(UPF1_dPSIs[[4]])

cat("number of LSVs from read length 36 to 100", fill = TRUE)
UPF1_nLSVs_readLength_36
UPF1_nLSVs_readLength_50
UPF1_nLSVs_readLength_75
UPF1_nLSVs_readLength_100

# create dataframe with nLSVs 
UPF1_nLSVs_df = data.frame(readLength=c("036", "050", "075", "100"),
                      nLSVs=c(UPF1_nLSVs_readLength_36, UPF1_nLSVs_readLength_50, UPF1_nLSVs_readLength_75, UPF1_nLSVs_readLength_100))

# number of LSVs bar chart
UPF1_nLSVs_bar = ggplot(data=UPF1_nLSVs_df, aes(x = readLength, y = nLSVs, fill = readLength)) +
  geom_bar(stat = "identity") +
  xlab("read length [nt]") +
  ylab("# LSVs") +
  ggtitle("A (UPF1)") +
  scale_fill_manual(name = "read length [nt]", values = c("#FAD8B4", "#F7B56D", "#DE872A", "#C85813"),  
                    labels = c("36", "50", "75", "100")) +
  scale_x_discrete(labels = c("36", "50", "75", "100")) +
  geom_text(aes(label=nLSVs), position=position_dodge(width=0.9), vjust=-0.25) 

UPF1_nLSVs_bar
```

<br>
<br> 

# Influence on LSV complexity
```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
# count junctions of each LSV
# create new list with the data frames that contain the information about the complexity of the LSVs
U2AF2_dPSIs = lapply(U2AF2_dPSIs, countJunctions)
U2AF2_complexityLSVs = lapply(U2AF2_dPSIs, complexityLSVs)
```


```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# add new column with read length to differ the data 
# when merging the single data frames to one 
U2AF2_complexityLSVs[[1]]$readLength = "036"
U2AF2_complexityLSVs[[2]]$readLength = "050"
U2AF2_complexityLSVs[[3]]$readLength = "075"
U2AF2_complexityLSVs[[4]]$readLength = "100"


# create data frame out of all read length to build a stacked bar chart
U2AF2_nJunctions_df <- rbind(U2AF2_complexityLSVs[[1]], U2AF2_complexityLSVs[[2]], U2AF2_complexityLSVs[[3]], U2AF2_complexityLSVs[[4]])


# all LSVs with junctions > 4 are grouped into one category
# so that all LSVs with > 4 junctions get the same color in following stacked bar chart
for (i in 1:nrow(U2AF2_nJunctions_df)){
  if (as.integer(U2AF2_nJunctions_df[i, "junctionsPerLSV"]) >= 5) {
    U2AF2_nJunctions_df[i, "junctionsPerLSV"] = 5
  }
}

# stacked bar chart to show complexity of LSVs for each read length
U2AF2_StackedBarChart_nJunctions = 
  ggplot(U2AF2_nJunctions_df, aes(fill = junctionsPerLSV, y = Freq, x = readLength)) + 
    geom_bar(position="fill", stat="identity") +
    scale_fill_brewer(palette = "Blues", name = "Junctions pro LSV", labels = c("2", "3", "4", "> 4")) +
    scale_x_discrete(labels = c("25", "50", "75", "100")) +
    xlab("Read-LÃ¤nge [nt]") +
    ylab("Anteil LSV's") +
    ggtitle("U2AF2") +
    theme(plot.title = element_text(face = "bold"))

# source: http://jessicacorman.weebly.com/news--musings/how-to-make-a-stacked-bar-chart-with-color-shading
U2AF2_StackedBarChart_nJunctions = ggplot(U2AF2_nJunctions_df, aes(x = readLength, y = Freq)) +
  geom_bar(stat = "identity", aes(fill = readLength), position = "fill", show.legend = FALSE) +
  scale_fill_manual(values = c("#FAD8B4", "#F7B56D", "#DE872A", "#C85813"),
                    labels = c("36", "50", "75", "100"),
                    name = "read length [nt]") + 
  geom_bar(stat = "identity", fill = "black", aes(alpha = junctionsPerLSV), position = "fill", show.legend = FALSE) +
  scale_alpha_manual(values = c(0, 0.3, 0.55, 0.8),
                     name = "junctions per LSV", 
                     breaks = c("2", "3", "4", "5"),
                     labels = c("2", "3", "4", "> 4")) +
  scale_x_discrete(labels = c("36", "50", "75", "100")) +
  xlab("read length [nt]") +
  ylab("fraction LSVs [%]") +
  ggtitle("B") 


U2AF2_StackedBarChart_nJunctions


# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/complexityLSVs_readLength_U2AF2.pdf", plot = U2AF2_StackedBarChart_nJunctions, width = 3, height = 6, units = "cm")

```
<br>
<br>

# Influence on the significance of LSVs
```{r}
# extract max. dPSI for each LSV and add new column with this information
U2AF2_dPSIs = lapply(U2AF2_dPSIs, extractMaxDPSIs)

# extract max. probability for each LSV and add a new column with this information
U2AF2_dPSIs = lapply(U2AF2_dPSIs, extractMaxProbs)
```

```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# plot the max. dPSI against the max. probability for each LSV 
U2AF2_significantDeltaPSI = ggarrange(
  
  ggplot(U2AF2_dPSIs[[1]], aes(x = maxDeltaPSI, y = maxProb)) +
    geom_point(alpha = .25, color = "#FAD8B4") +
    geom_hline(yintercept = probabilityThreshold, col = "red3", linetype = "dashed", size = 0.62) +
    geom_vline(xintercept = 0.05, col = "red3", linetype = "dashed", size = 0.62) +
    xlab("\u0394\u03A8") +
    ggtitle("36 nt read length"),
  
  ggplot(U2AF2_dPSIs[[2]], aes(x = maxDeltaPSI, y = maxProb)) +
    geom_point(alpha = .25, color = "#F7B56D") +
    geom_hline(yintercept = probabilityThreshold, col = "red3", linetype = "dashed", size = 0.62) +
    geom_vline(xintercept = 0.05, col = "red3", linetype = "dashed", size = 0.62) +
    xlab("\u0394\u03A8") +
    ggtitle("50 nt read length"),
  
  ggplot(U2AF2_dPSIs[[3]], aes(x = maxDeltaPSI, y = maxProb)) +
    geom_point(alpha = .25, color = "#DE872A") +
    geom_hline(yintercept = probabilityThreshold, col = darken("red3", 0.2), linetype = "dashed", size = 0.62) +
    geom_vline(xintercept = 0.05, col = darken("red3", 0.2), linetype = "dashed", size = 0.62) +
    xlab("\u0394\u03A8") +
    ggtitle("75 nt read length"),
  
  ggplot(U2AF2_dPSIs[[4]], aes(x = maxDeltaPSI, y = maxProb)) +
    geom_point(alpha = .25, color = "#C85813") +
    geom_hline(yintercept = probabilityThreshold, col = "red3", linetype = "dashed", size = 0.62) +
    geom_vline(xintercept = 0.05, col = "red3", linetype = "dashed", size = 0.62) +
    xlab("\u0394\u03A8") +
    ggtitle("100 nt read length"),
  
  
  nrow = 2, ncol = 2
)

U2AF2_significantDeltaPSI = annotate_figure(U2AF2_significantDeltaPSI, top = text_grob("U2AF2", size = 16, just = "centre", face = "bold"))
U2AF2_significantDeltaPSI

scatter_readLength = ggplot(U2AF2_dPSIs[[4]], aes(x = maxDeltaPSI, y = maxProb)) + geom_pointdensity() +
                      scale_color_viridis(option = "rocket") +
                      geom_hline(yintercept = probabilityThreshold, col = "red3", linetype = "dashed", size = 0.62) +
                      geom_vline(xintercept = 0.05, col = "red3", linetype = "dashed", size = 0.62) +
                      xlab("\u0394\u03A8") +
                      ggtitle("A")

scatter_readLength

# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/scatter_readLength.pdf", plot = scatter_readLength, width = 8, height = 6, units = "cm")

```

<br>
<br>

```{r}
# add new column "significant" for each read length which could be TRUE/FALSE 
# TRUE if maxProb >= 0.9 and maxDPSI >= 0.05 (significance threshold)
U2AF2_dPSIs[[1]]$significant = U2AF2_dPSIs[[1]]$maxProb >= probabilityThreshold & U2AF2_dPSIs[[1]]$maxDeltaPSI >= 0.05
U2AF2_dPSIs[[2]]$significant = U2AF2_dPSIs[[2]]$maxProb >= probabilityThreshold & U2AF2_dPSIs[[2]]$maxDeltaPSI >= 0.05
U2AF2_dPSIs[[3]]$significant = U2AF2_dPSIs[[3]]$maxProb >= probabilityThreshold & U2AF2_dPSIs[[3]]$maxDeltaPSI >= 0.05
U2AF2_dPSIs[[4]]$significant = U2AF2_dPSIs[[4]]$maxProb >= probabilityThreshold & U2AF2_dPSIs[[4]]$maxDeltaPSI >= 0.05

# significant LSVs for each read length
print("# significant LSVs")
table(U2AF2_dPSIs[[1]]$significant)
table(U2AF2_dPSIs[[2]]$significant)
table(U2AF2_dPSIs[[3]]$significant)
table(U2AF2_dPSIs[[4]]$significant)

# count significant and not significant LSVs for each read length
U2AF2_nSignificant_36 = sum(U2AF2_dPSIs[[1]]$significant)
U2AF2_nNotSignificant_36 = (U2AF2_nLSVs_readLength_36-sum(U2AF2_dPSIs[[1]]$significant))
U2AF2_nSignificant_50 = sum(U2AF2_dPSIs[[2]]$significant)
U2AF2_nNotSignificant_50 = (U2AF2_nLSVs_readLength_50-sum(U2AF2_dPSIs[[2]]$significant))
U2AF2_nSignificant_75 = sum(U2AF2_dPSIs[[3]]$significant)
U2AF2_nNotSignificant_75 = (U2AF2_nLSVs_readLength_75-sum(U2AF2_dPSIs[[3]]$significant))
U2AF2_nSignificant_100 = sum(U2AF2_dPSIs[[4]]$significant)
U2AF2_nNotSignificant_100 = (U2AF2_nLSVs_readLength_100-sum(U2AF2_dPSIs[[4]]$significant))

# create data frame with a column for the read length
# and a column indicating whether the associated LSV is significant or not 
U2AF2_significantLSVs_df_relative = data.frame(comparison=c(rep("036", nrow(U2AF2_dPSIs[[1]])),
                                                   rep("050", nrow(U2AF2_dPSIs[[2]])), 
                                                   rep("075", nrow(U2AF2_dPSIs[[3]])), 
                                                   rep("100", nrow(U2AF2_dPSIs[[4]]))),
                                      significant=c(U2AF2_dPSIs[[1]]$significant,
                                                    U2AF2_dPSIs[[2]]$significant, 
                                                    U2AF2_dPSIs[[3]]$significant, 
                                                    U2AF2_dPSIs[[4]]$significant))


# differ between the significance of LSVs of different sample combinations to plot them in different colors 
for (i in 1:nrow(U2AF2_significantLSVs_df_relative)){
  if (U2AF2_significantLSVs_df_relative[i, "comparison"] == "036" && U2AF2_significantLSVs_df_relative[i, "significant"] == TRUE){
    U2AF2_significantLSVs_df_relative[i, "significant"] = "TRUE read length 036"
  }
  if (U2AF2_significantLSVs_df_relative[i, "comparison"] == "050" && U2AF2_significantLSVs_df_relative[i, "significant"] == TRUE){
    U2AF2_significantLSVs_df_relative[i, "significant"] = "TRUE read length 050"
  }
  if (U2AF2_significantLSVs_df_relative[i, "comparison"] == "075" && U2AF2_significantLSVs_df_relative[i, "significant"] == TRUE){
    U2AF2_significantLSVs_df_relative[i, "significant"] = "TRUE read length 075"
  }
  if (U2AF2_significantLSVs_df_relative[i, "comparison"] == "100" && U2AF2_significantLSVs_df_relative[i, "significant"] == TRUE){
    U2AF2_significantLSVs_df_relative[i, "significant"] = "TRUE read length 100"
  }
}

# percentage stacked bar chart
# stacked bar chart showing fraction of significant LSVs among all LSVs for each read length   
U2AF2_nSignificantLSVs_bar_relative = ggplot(data=U2AF2_significantLSVs_df_relative, aes(x = comparison, fill = factor(significant))) +
  geom_bar(position = "fill", show.legend = FALSE) +
  xlab("read length [nt]") +
  ylab("fraction LSVs [%]") +
  coord_cartesian(ylim = c(0, 0.07)) +
  scale_fill_manual(name= "significant", values = c("lightgrey", "#FAD8B4", "#F7B56D", "#DE872A", "#C85813"), labels = c("FALSE", "TRUE", "TRUE", "TRUE", "TRUE")) +
  scale_x_discrete(labels = c("36", "50", "75", "100")) +
  scale_color_manual(name = "mean 2 samples") +
  ggtitle("A")

U2AF2_nSignificantLSVs_bar_relative

# total counts
# create dataframe with number of significant regulated LSVs
U2AF2_nSignificantLSVs_df_absolute = data.frame(readLength=c("036", "050", "075", "100"),
                      nSignificantLSVs=c(U2AF2_nSignificant_36, U2AF2_nSignificant_50, U2AF2_nSignificant_75, U2AF2_nSignificant_100))

# number of signifcant LSVs bar chart
U2AF2_nSignificantLSVs_bar_absolute = ggplot(data=U2AF2_nSignificantLSVs_df_absolute, aes(x = readLength, y = nSignificantLSVs, fill = readLength)) +
  geom_bar(stat = "identity") +
  xlab("read length [nt]") +
  ylab("# significant LSVs") +
  ggtitle("A") +
  scale_fill_manual(name = "read length [nt]", values = c("#FAD8B4", "#F7B56D", "#DE872A", "#C85813"), 
                    labels = c("36", "50", "75", "100")) +
  scale_x_discrete(labels = c("36", "50", "75", "100")) +
  geom_text(aes(label=nSignificantLSVs), position=position_dodge(width=0.9), vjust=1) 

U2AF2_nSignificantLSVs_bar_absolute 

# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plotsU2AF2_nSignficantLSVs_read_length_absolute.pdf", plot = U2AF2_nSignificantLSVs_bar_absolute, width = 3, height = 6, units = "cm")
ggsave(filename = "U2AF2_nSignficantLSVs_read_length_relative.pdf", plot = U2AF2_nSignificantLSVs_bar_relative, width = 3, height = 6, units = "cm")


```
<br>
<br>

```{r}
# shared significant LSVs (upset plot)

# check number of regulated LSVs
# TRUE = 1, FALSE = 0
sum(U2AF2_dPSIs[[1]]$significant)
sum(U2AF2_dPSIs[[2]]$significant)
sum(U2AF2_dPSIs[[3]]$significant)
sum(U2AF2_dPSIs[[4]]$significant)

# extract all significant LSVs for each read length
U2AF2_significantLSVs_36 = U2AF2_dPSIs[[1]]$lsv_id[U2AF2_dPSIs[[1]]$significant == TRUE]

U2AF2_significantLSVs_50 = U2AF2_dPSIs[[2]]$lsv_id[U2AF2_dPSIs[[2]]$significant == TRUE]

U2AF2_significantLSVs_75 = U2AF2_dPSIs[[3]]$lsv_id[U2AF2_dPSIs[[3]]$significant == TRUE]

U2AF2_significantLSVs_100 = U2AF2_dPSIs[[4]]$lsv_id[U2AF2_dPSIs[[4]]$significant == TRUE]

# create list with all significant LSVs for each read length
U2AF2_significantLSVs_all = list("36" = c(U2AF2_significantLSVs_36), "50" = c(U2AF2_significantLSVs_50), "75" = c(U2AF2_significantLSVs_75), "100" = c(U2AF2_significantLSVs_100))

# upset plot
pdf(file="C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/upset_read_length.pdf", width=3.6, height=3) # or other device
# make upset plot from this information
upset(fromList(U2AF2_significantLSVs_all), 
      order.by = "freq", 
      sets.bar.color = c("#FAD8B4", "#F7B56D", "#DE872A", "#C85813"), 
      sets.x.label = "# LSVs", 
      mainbar.y.label = "# shared significant LSVs")
dev.off()
```

<br>
<br>

# Influence on size of detected splicing changes
```{r}
U2AF2_dPSIs[[1]]$readLength = "036"
U2AF2_dPSIs[[2]]$readLength = "50"
U2AF2_dPSIs[[3]]$readLength = "75"
U2AF2_dPSIs[[4]]$readLength = "100"

# ecdf for dPSIs and probability changing
ecdf_deltaPSI = ggplot() +
  stat_ecdf(aes(x = maxDeltaPSI), color = "black", data = U2AF2_dPSIs[[1]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxDeltaPSI, color = "036"), data = U2AF2_dPSIs[[1]], size = 1, pad = FALSE) +
  
  stat_ecdf(aes(x = maxDeltaPSI), color = "black", data = U2AF2_dPSIs[[2]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxDeltaPSI, color = "050"), data = U2AF2_dPSIs[[2]], size = 1, pad = FALSE) +
  
  stat_ecdf(aes(x = maxDeltaPSI), color = "black", data = U2AF2_dPSIs[[3]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxDeltaPSI, color = "075"), data = U2AF2_dPSIs[[3]], size = 1, pad = FALSE) +
  
  stat_ecdf(aes(x = maxDeltaPSI), color = "black", data = U2AF2_dPSIs[[4]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxDeltaPSI, color = "100"), data = U2AF2_dPSIs[[4]], size = 1, pad = FALSE) +
  scale_color_manual(values = c("#FAD8B4", "#FFB565", "#DE872A", "#C85813"), 
                     name = "read length  [nt]", 
                     labels = c("36", "50", "75", "100", "36", "50", "75", "100")) + 
  geom_vline(xintercept = 0.05, col = "red3", linetype = "dashed", size = 0.5) +
  coord_cartesian(xlim=c(0, 0.5)) +
  #xlim(0, 0.5) +
  ylab("ecdf") +
  xlab("dPSI") +
  ggtitle("A") +
  theme(legend.position="none")

ecdf_prob_changing = ggplot() +
  stat_ecdf(aes(x = maxProb), color = "black", data = U2AF2_dPSIs[[1]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxProb, color = readLength), data = U2AF2_dPSIs[[1]], size = 1, pad = FALSE) +
  
  stat_ecdf(aes(x = maxProb), color = "black", data = U2AF2_dPSIs[[2]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxProb, color = readLength), data = U2AF2_dPSIs[[2]], size = 1, pad = FALSE) +
  
  stat_ecdf(aes(x = maxProb), color = "black", data = U2AF2_dPSIs[[3]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxProb, color = readLength), data = U2AF2_dPSIs[[3]], size = 1, pad = FALSE) +
  
  stat_ecdf(aes(x = maxProb), color = "black", data = U2AF2_dPSIs[[4]], size = 1.25, pad = FALSE) +
  stat_ecdf(aes(x = maxProb, color = readLength), data = U2AF2_dPSIs[[4]], size = 1, pad = FALSE) +
  scale_color_manual(name = "read length  [nt]", values = c("#FAD8B4", "#FFB565", "#DE872A", "#C85813"), 
                     labels = c("36", "50", "75", "100")) + 
  geom_vline(xintercept = 0.9, col = "red3", linetype = "dashed", size = 0.5) +
  xlim(0, 1) +
  ylab("ecdf") +
  xlab("P(|dPSI| > 0.05)") +
  ggtitle("A") +
  theme(legend.position="none")

ecdf_deltaPSI
ecdf_prob_changing 

# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/ecdf_dPSI_readLength.pdf", plot = ecdf_deltaPSI, width = 4.2, height = 4.2, units = "cm")

ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/ecdf_probChanging_readLength_2.pdf", plot = ecdf_prob_changing, width = 4.2, height = 4.2, units = "cm")
```
<br>
<br>

## Shared binary regulation between the different read length
```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# ALL BINARY LSVs
# --------------------------------------------------------------------------------------------------------------------------------------

# filter the data frames for LSVs with 2 Junctions
# significance shown
U2AF2_100_filtered = U2AF2_dPSIs[[4]][U2AF2_dPSIs[[4]]$nJunctions == 2,]

U2AF2_75_filtered = U2AF2_dPSIs[[3]][U2AF2_dPSIs[[3]]$nJunctions == 2,]

U2AF2_50_filtered = U2AF2_dPSIs[[2]][U2AF2_dPSIs[[2]]$nJunctions == 2,]

U2AF2_36_filtered = U2AF2_dPSIs[[1]][U2AF2_dPSIs[[1]]$nJunctions == 2,]

# identify shared significant LSVs for each comparison
# comparison 100/75, 100/50, 100/36
# just extracts the LSV IDs that intersect
U2AF2_shared_100_75 = intersect(U2AF2_100_filtered$lsv_id, U2AF2_75_filtered$lsv_id) 
length(U2AF2_shared_100_75)

U2AF2_shared_100_50 = intersect(U2AF2_100_filtered$lsv_id, U2AF2_50_filtered$lsv_id) 
length(U2AF2_shared_100_50)

U2AF2_shared_100_36 = intersect(U2AF2_100_filtered$lsv_id, U2AF2_36_filtered$lsv_id)
length(U2AF2_shared_100_36)

U2AF2_shared_75_50 = intersect(U2AF2_75_filtered$lsv_id, U2AF2_50_filtered$lsv_id)
length(U2AF2_shared_75_50)

U2AF2_shared_75_36 = intersect(U2AF2_75_filtered$lsv_id, U2AF2_36_filtered$lsv_id)
length(U2AF2_shared_75_36)

U2AF2_shared_50_36 = intersect(U2AF2_50_filtered$lsv_id, U2AF2_36_filtered$lsv_id)
length(U2AF2_shared_50_36)


# extract filtered LSVs from the data frames above
# compare 100 with 75
U2AF2_100_filtered_match_75 <- U2AF2_100_filtered[match(U2AF2_shared_100_75, U2AF2_100_filtered$lsv_id),]

U2AF2_75_filtered_match_100 <- U2AF2_75_filtered[match(U2AF2_shared_100_75, U2AF2_75_filtered$lsv_id),]

# compare 100 with 50
U2AF2_100_filtered_match_50 <- U2AF2_100_filtered[match(U2AF2_shared_100_50, U2AF2_100_filtered$lsv_id),]

U2AF2_50_filtered_match_100 <- U2AF2_50_filtered[match(U2AF2_shared_100_50, U2AF2_50_filtered$lsv_id),]

# compare 100 with 36
U2AF2_100_filtered_match_36 <- U2AF2_100_filtered[match(U2AF2_shared_100_36, U2AF2_100_filtered$lsv_id),]

U2AF2_36_filtered_match_100 <- U2AF2_36_filtered[match(U2AF2_shared_100_36, U2AF2_36_filtered$lsv_id),]

# compare 75 with 50
U2AF2_75_filtered_match_50 <- U2AF2_75_filtered[match(U2AF2_shared_75_50, U2AF2_75_filtered$lsv_id),]

U2AF2_50_filtered_match_75 <- U2AF2_50_filtered[match(U2AF2_shared_75_50, U2AF2_50_filtered$lsv_id),]

# compare 75 with 36
U2AF2_75_filtered_match_36 <- U2AF2_75_filtered[match(U2AF2_shared_75_36, U2AF2_75_filtered$lsv_id),]

U2AF2_36_filtered_match_75 <- U2AF2_36_filtered[match(U2AF2_shared_75_36, U2AF2_36_filtered$lsv_id),]

# compare 50 with 36
U2AF2_50_filtered_match_36 <- U2AF2_50_filtered[match(U2AF2_shared_50_36, U2AF2_50_filtered$lsv_id),]

U2AF2_36_filtered_match_50 <- U2AF2_36_filtered[match(U2AF2_shared_50_36, U2AF2_36_filtered$lsv_id),]


# extract dPSI value of the first junction for all LSVs
# deltapsi 100 vs 75 
deltaPSI_U2AF2_100_vs_75 = U2AF2_100_filtered_match_75$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

deltaPSI_U2AF2_75_vs_100 = U2AF2_75_filtered_match_100$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 100 vs 50 
deltaPSI_U2AF2_100_vs_50 = U2AF2_100_filtered_match_50$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

deltaPSI_U2AF2_50_vs_100 = U2AF2_50_filtered_match_100$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 100 vs 36 
deltaPSI_U2AF2_100_vs_36 = U2AF2_100_filtered_match_36$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_100 = U2AF2_36_filtered_match_100$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 75 vs 50
deltaPSI_U2AF2_75_vs_50 = U2AF2_75_filtered_match_50$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_50_vs_75 = U2AF2_50_filtered_match_75$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 75 vs 36
deltaPSI_U2AF2_75_vs_36 = U2AF2_75_filtered_match_36$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_75 = U2AF2_36_filtered_match_75$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 50 vs 36
deltaPSI_U2AF2_50_vs_36 = U2AF2_50_filtered_match_36$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_50 = U2AF2_36_filtered_match_50$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric


# SIGNIFICANT BINARY LSVs
# --------------------------------------------------------------------------------------------------------------------------------------

# filter the data frames for significant LSVs with 2 Junctions
U2AF2_100_filtered_sig = U2AF2_dPSIs[[4]][U2AF2_dPSIs[[4]]$nJunctions == 2 & U2AF2_dPSIs[[4]]$significant == TRUE,]

U2AF2_75_filtered_sig = U2AF2_dPSIs[[3]][U2AF2_dPSIs[[3]]$nJunctions == 2 & U2AF2_dPSIs[[3]]$significant == TRUE,]

U2AF2_50_filtered_sig = U2AF2_dPSIs[[2]][U2AF2_dPSIs[[2]]$nJunctions == 2 & U2AF2_dPSIs[[2]]$significant == TRUE,]

U2AF2_36_filtered_sig = U2AF2_dPSIs[[1]][U2AF2_dPSIs[[1]]$nJunctions == 2 & U2AF2_dPSIs[[1]]$significant == TRUE,]


# identify shared significant LSVs for each comparison
# comparison 100/75, 100/50, 100/36
U2AF2_shared_100_75_sig = intersect(U2AF2_100_filtered_sig$lsv_id, U2AF2_75_filtered_sig$lsv_id) 
length(U2AF2_shared_100_75_sig)

U2AF2_shared_100_50_sig = intersect(U2AF2_100_filtered_sig$lsv_id, U2AF2_50_filtered_sig$lsv_id) 
length(U2AF2_shared_100_50_sig)

U2AF2_shared_100_36_sig = intersect(U2AF2_100_filtered_sig$lsv_id, U2AF2_36_filtered_sig$lsv_id)
length(U2AF2_shared_100_36_sig)

U2AF2_shared_75_50_sig = intersect(U2AF2_75_filtered_sig$lsv_id, U2AF2_50_filtered_sig$lsv_id)
length(U2AF2_shared_75_50_sig)

U2AF2_shared_75_36_sig = intersect(U2AF2_75_filtered_sig$lsv_id, U2AF2_36_filtered_sig$lsv_id)
length(U2AF2_shared_75_36_sig)

U2AF2_shared_50_36_sig = intersect(U2AF2_50_filtered_sig$lsv_id, U2AF2_36_filtered_sig$lsv_id)
length(U2AF2_shared_50_36_sig)


# extract filtered LSVs from the data frames above
# compare 100 with 75
U2AF2_100_filtered_match_75_sig <- U2AF2_100_filtered_sig[match(U2AF2_shared_100_75_sig, U2AF2_100_filtered_sig$lsv_id),]

U2AF2_75_filtered_match_100_sig <- U2AF2_75_filtered_sig[match(U2AF2_shared_100_75_sig, U2AF2_75_filtered_sig$lsv_id),]

# compare 100 with 50
U2AF2_100_filtered_match_50_sig <- U2AF2_100_filtered_sig[match(U2AF2_shared_100_50_sig, U2AF2_100_filtered_sig$lsv_id),]

U2AF2_50_filtered_match_100_sig <- U2AF2_50_filtered_sig[match(U2AF2_shared_100_50_sig, U2AF2_50_filtered_sig$lsv_id),]

# compare 100 with 36
U2AF2_100_filtered_match_36_sig <- U2AF2_100_filtered_sig[match(U2AF2_shared_100_36_sig, U2AF2_100_filtered_sig$lsv_id),]

U2AF2_36_filtered_match_100_sig <- U2AF2_36_filtered_sig[match(U2AF2_shared_100_36_sig, U2AF2_36_filtered_sig$lsv_id),]

# compare 75 with 50
U2AF2_75_filtered_match_50_sig <- U2AF2_75_filtered_sig[match(U2AF2_shared_75_50_sig, U2AF2_75_filtered_sig$lsv_id),]

U2AF2_50_filtered_match_75_sig <- U2AF2_50_filtered_sig[match(U2AF2_shared_75_50_sig, U2AF2_50_filtered_sig$lsv_id),]

# compare 75 with 36
U2AF2_75_filtered_match_36_sig <- U2AF2_75_filtered_sig[match(U2AF2_shared_75_36_sig, U2AF2_75_filtered_sig$lsv_id),]

U2AF2_36_filtered_match_75_sig <- U2AF2_36_filtered_sig[match(U2AF2_shared_75_36_sig, U2AF2_36_filtered_sig$lsv_id),]

# compare 50 with 36
U2AF2_50_filtered_match_36_sig <- U2AF2_50_filtered_sig[match(U2AF2_shared_50_36_sig, U2AF2_50_filtered_sig$lsv_id),]

U2AF2_36_filtered_match_50_sig <- U2AF2_36_filtered_sig[match(U2AF2_shared_50_36_sig, U2AF2_36_filtered_sig$lsv_id),]


# extract dPSI value of the first junction for all LSVs
# deltapsi 100 vs 75 
deltaPSI_U2AF2_100_vs_75_sig = U2AF2_100_filtered_match_75_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

deltaPSI_U2AF2_75_vs_100_sig = U2AF2_75_filtered_match_100_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 100 vs 50 
deltaPSI_U2AF2_100_vs_50_sig = U2AF2_100_filtered_match_50_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

deltaPSI_U2AF2_50_vs_100_sig = U2AF2_50_filtered_match_100_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 100 vs 36 
deltaPSI_U2AF2_100_vs_36_sig = U2AF2_100_filtered_match_36_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_100_sig = U2AF2_36_filtered_match_100_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 75 vs 50
deltaPSI_U2AF2_75_vs_50_sig = U2AF2_75_filtered_match_50_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_50_vs_75_sig = U2AF2_50_filtered_match_75_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 75 vs 36
deltaPSI_U2AF2_75_vs_36_sig = U2AF2_75_filtered_match_36_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_75_sig = U2AF2_36_filtered_match_75_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 50 vs 36
deltaPSI_U2AF2_50_vs_36_sig = U2AF2_50_filtered_match_36_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_50_sig = U2AF2_36_filtered_match_50_sig$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

```

```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
# build data frame out of vectors with dPSI values 
# create scatter plot with the data frames

# correlation data frame 100 vs 75
U2AF2_correlationDataFrame_100_vs_75 <- data.frame(deltaPSI_U2AF2_100_vs_75, deltaPSI_U2AF2_75_vs_100)
U2AF2_correlationDataFrame_100_vs_75_sig <- data.frame(deltaPSI_U2AF2_100_vs_75_sig, deltaPSI_U2AF2_75_vs_100_sig)

U2AF2_sharedRegulation_scatterPlot1 = ggplot(data=U2AF2_correlationDataFrame_100_vs_75, aes(x=deltaPSI_U2AF2_100_vs_75, deltaPSI_U2AF2_75_vs_100)) +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  ggrastr::geom_point_rast(alpha=0.36, color="darkgrey", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_100_vs_75, aes(x=deltaPSI_U2AF2_100_vs_75, deltaPSI_U2AF2_75_vs_100), method = "lm", color="darkgrey", se=FALSE) +
  ggrastr::geom_point_rast(data=U2AF2_correlationDataFrame_100_vs_75_sig, aes(x=deltaPSI_U2AF2_100_vs_75_sig, y=deltaPSI_U2AF2_75_vs_100_sig), color="black", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_100_vs_75_sig, aes(x=deltaPSI_U2AF2_100_vs_75_sig, y=deltaPSI_U2AF2_75_vs_100_sig),method = "lm", color="black", se=FALSE) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +
  coord_fixed(ratio = 1) +
  geom_abline(xintercept=0, slope=1, linetype="dashed", size=.75, color="firebrick2") +
  xlab("dPSI 100 nt read length") +
  ylab("dPSI 75 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 100 vs 50
U2AF2_correlationDataFrame_100_vs_50 <- data.frame(deltaPSI_U2AF2_100_vs_50, deltaPSI_U2AF2_50_vs_100)
U2AF2_correlationDataFrame_100_vs_50_sig <- data.frame(deltaPSI_U2AF2_100_vs_50_sig, deltaPSI_U2AF2_50_vs_100_sig)

U2AF2_sharedRegulation_scatterPlot2 = ggplot(data=U2AF2_correlationDataFrame_100_vs_50, aes(x=deltaPSI_U2AF2_100_vs_50, deltaPSI_U2AF2_50_vs_100)) + 
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  ggrastr::geom_point_rast(alpha=0.36, color="darkgrey", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_100_vs_50, aes(x=deltaPSI_U2AF2_100_vs_50, deltaPSI_U2AF2_50_vs_100), method = "lm", color="darkgrey", se=FALSE) +
  ggrastr::geom_point_rast(data=U2AF2_correlationDataFrame_100_vs_50_sig, aes(x=deltaPSI_U2AF2_100_vs_50_sig, y=deltaPSI_U2AF2_50_vs_100_sig), color="black", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_100_vs_50_sig, aes(x=deltaPSI_U2AF2_100_vs_50_sig, y=deltaPSI_U2AF2_50_vs_100_sig),method = "lm", color="black", se=FALSE) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") + 
  geom_abline(xintercept=0, slope=1, linetype="dashed", size=.75, color="firebrick2") +
  coord_cartesian(xlim = c(-0.7, 0.7), ylim = c(-0.7, 0.7)) +
  xlab("dPSI 100 nt read length") +
  ylab("dPSI 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  theme(aspect.ratio=1) +
  ggtitle("D")

# correlation data frame 100 vs 36
U2AF2_correlationDataFrame_100_vs_36 <- data.frame(deltaPSI_U2AF2_100_vs_36, deltaPSI_U2AF2_36_vs_100)
U2AF2_correlationDataFrame_100_vs_36_sig <- data.frame(deltaPSI_U2AF2_100_vs_36_sig, deltaPSI_U2AF2_36_vs_100_sig)

U2AF2_sharedRegulation_scatterPlot3 = ggplot(data=U2AF2_correlationDataFrame_100_vs_36, aes(x=deltaPSI_U2AF2_100_vs_36, deltaPSI_U2AF2_36_vs_100)) +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  ggrastr::geom_point_rast(alpha=0.36, color="darkgrey", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_100_vs_36, aes(x=deltaPSI_U2AF2_100_vs_36, deltaPSI_U2AF2_36_vs_100), method = "lm", color="darkgrey", se=FALSE) +
  ggrastr::geom_point_rast(data=U2AF2_correlationDataFrame_100_vs_36_sig, aes(x=deltaPSI_U2AF2_100_vs_36_sig, y=deltaPSI_U2AF2_36_vs_100_sig), color="black", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_100_vs_36_sig, aes(x=deltaPSI_U2AF2_100_vs_36_sig, y=deltaPSI_U2AF2_36_vs_100_sig),method = "lm", color="black", se=FALSE) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  geom_abline(xintercept=0, slope=1, linetype="dashed", size=.75, color="firebrick2") +
  coord_fixed(ratio = 1) +
  xlab("dPSI 100 nt read length") +
  ylab("dPSI 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 75 vs 50
U2AF2_correlationDataFrame_75_vs_50 <- data.frame(deltaPSI_U2AF2_75_vs_50, deltaPSI_U2AF2_50_vs_75)
U2AF2_correlationDataFrame_75_vs_50_sig <- data.frame(deltaPSI_U2AF2_75_vs_50_sig, deltaPSI_U2AF2_50_vs_75_sig)

U2AF2_sharedRegulation_scatterPlot4 = ggplot(data=U2AF2_correlationDataFrame_75_vs_50, aes(x=deltaPSI_U2AF2_75_vs_50, deltaPSI_U2AF2_50_vs_75)) +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  ggrastr::geom_point_rast(alpha=0.36, color="darkgrey", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_75_vs_50, aes(x=deltaPSI_U2AF2_75_vs_50, deltaPSI_U2AF2_50_vs_75), method = "lm", color="darkgrey", se=FALSE) +
  ggrastr::geom_point_rast(data=U2AF2_correlationDataFrame_75_vs_50_sig, aes(x=deltaPSI_U2AF2_75_vs_50_sig, y=deltaPSI_U2AF2_50_vs_75_sig), color="black", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_75_vs_50_sig, aes(x=deltaPSI_U2AF2_75_vs_50_sig, y=deltaPSI_U2AF2_50_vs_75_sig),method = "lm", color="black", se=FALSE) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  geom_abline(xintercept=0, slope=1, linetype="dashed", size=.75, color="firebrick2") +
  coord_fixed(ratio = 1) +
  xlab("dPSI 75 nt read length") +
  ylab("dPSI 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 75 vs 36
U2AF2_correlationDataFrame_75_vs_36 <- data.frame(deltaPSI_U2AF2_75_vs_36, deltaPSI_U2AF2_36_vs_75)
U2AF2_correlationDataFrame_75_vs_36_sig <- data.frame(deltaPSI_U2AF2_75_vs_36_sig, deltaPSI_U2AF2_36_vs_75_sig)

U2AF2_sharedRegulation_scatterPlot5 = ggplot(data=U2AF2_correlationDataFrame_75_vs_36, aes(x=deltaPSI_U2AF2_75_vs_36, deltaPSI_U2AF2_36_vs_75)) +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  ggrastr::geom_point_rast(alpha=0.36, color="darkgrey", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_75_vs_36, aes(x=deltaPSI_U2AF2_75_vs_36, deltaPSI_U2AF2_36_vs_75), method = "lm", color="darkgrey", se=FALSE) +
  ggrastr::geom_point_rast(data=U2AF2_correlationDataFrame_75_vs_36_sig, aes(x=deltaPSI_U2AF2_75_vs_36_sig, y=deltaPSI_U2AF2_36_vs_75_sig), color="black", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_75_vs_36_sig, aes(x=deltaPSI_U2AF2_75_vs_36_sig, y=deltaPSI_U2AF2_36_vs_75_sig),method = "lm", color="black", se=FALSE) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  geom_abline(xintercept=0, slope=1, linetype="dashed", size=.75, color="firebrick2") +
  coord_fixed(ratio = 1) +
  xlab("dPSI 75 nt read length") +
  ylab("dPSI 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 50 vs 36
U2AF2_correlationDataFrame_50_vs_36 <- data.frame(deltaPSI_U2AF2_50_vs_36, deltaPSI_U2AF2_36_vs_50)
U2AF2_correlationDataFrame_50_vs_36_sig <- data.frame(deltaPSI_U2AF2_50_vs_36_sig, deltaPSI_U2AF2_36_vs_50_sig)

U2AF2_sharedRegulation_scatterPlot6 = ggplot(data=U2AF2_correlationDataFrame_50_vs_36, aes(x=deltaPSI_U2AF2_50_vs_36, deltaPSI_U2AF2_36_vs_50)) +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  ggrastr::geom_point_rast(alpha=0.36, color="darkgrey", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_50_vs_36, aes(x=deltaPSI_U2AF2_50_vs_36, deltaPSI_U2AF2_36_vs_50), method = "lm", color="darkgrey", se=FALSE) +
  ggrastr::geom_point_rast(data=U2AF2_correlationDataFrame_50_vs_36_sig, aes(x=deltaPSI_U2AF2_50_vs_36_sig, y=deltaPSI_U2AF2_36_vs_50_sig), color="black", size=0.3) +
  geom_smooth(data=U2AF2_correlationDataFrame_50_vs_36_sig, aes(x=deltaPSI_U2AF2_50_vs_36_sig, y=deltaPSI_U2AF2_36_vs_50_sig),method = "lm", color="black", se=FALSE) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  geom_abline(xintercept=0, slope=1, linetype="dashed", size=.75, color="firebrick2") +
  coord_fixed(ratio = 1) +
  xlab("\u0394\u03A8 50 nt read length") +
  ylab("\u0394\u03A8 36 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

U2AF2_sharedRegulation_scatterPlot1
U2AF2_sharedRegulation_scatterPlot2
U2AF2_sharedRegulation_scatterPlot3
U2AF2_sharedRegulation_scatterPlot4
U2AF2_sharedRegulation_scatterPlot5
U2AF2_sharedRegulation_scatterPlot6

'# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_100_75.pdf", plot = U2AF2_sharedRegulation_scatterPlot1)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_100_50.pdf", plot = U2AF2_sharedRegulation_scatterPlot2)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_100_36.pdf", plot = U2AF2_sharedRegulation_scatterPlot3)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_75_50.pdf", plot = U2AF2_sharedRegulation_scatterPlot4)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_50_36.pdf", plot = U2AF2_sharedRegulation_scatterPlot5)'

ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRegulation_100_50_readLength.pdf", plot = U2AF2_sharedRegulation_scatterPlot2, width = 5, height = 5, units = "cm")
```

```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
'# shared significant binary regulation between the different read length
# filter the data frames for significant LSVs with 2 Junctions
U2AF2_100_filtered = U2AF2_dPSIs[[4]][U2AF2_dPSIs[[4]]$nJunctions == 2 & U2AF2_dPSIs[[4]]$significant == TRUE,]

U2AF2_75_filtered = U2AF2_dPSIs[[3]][U2AF2_dPSIs[[3]]$nJunctions == 2 & U2AF2_dPSIs[[3]]$significant == TRUE,]

U2AF2_50_filtered = U2AF2_dPSIs[[2]][U2AF2_dPSIs[[2]]$nJunctions == 2 & U2AF2_dPSIs[[2]]$significant == TRUE,]

U2AF2_36_filtered = U2AF2_dPSIs[[1]][U2AF2_dPSIs[[1]]$nJunctions == 2 & U2AF2_dPSIs[[1]]$significant == TRUE,]


# identify shared significant LSVs for each comparison
# comparison 100/75, 100/50, 100/36
U2AF2_shared_100_75 = intersect(U2AF2_100_filtered$lsv_id, U2AF2_75_filtered$lsv_id) 
length(U2AF2_shared_100_75)

U2AF2_shared_100_50 = intersect(U2AF2_100_filtered$lsv_id, U2AF2_50_filtered$lsv_id) 
length(U2AF2_shared_100_50)

U2AF2_shared_100_36 = intersect(U2AF2_100_filtered$lsv_id, U2AF2_36_filtered$lsv_id)
length(U2AF2_shared_100_36)

U2AF2_shared_75_50 = intersect(U2AF2_75_filtered$lsv_id, U2AF2_50_filtered$lsv_id)
length(U2AF2_shared_75_50)

U2AF2_shared_75_36 = intersect(U2AF2_75_filtered$lsv_id, U2AF2_36_filtered$lsv_id)
length(U2AF2_shared_75_36)

U2AF2_shared_50_36 = intersect(U2AF2_50_filtered$lsv_id, U2AF2_36_filtered$lsv_id)
length(U2AF2_shared_50_36)


# extract filtered LSVs from the data frames above
# compare 100 with 75
U2AF2_100_filtered_match_75 <- U2AF2_100_filtered[match(U2AF2_shared_100_75, U2AF2_100_filtered$lsv_id),]

U2AF2_75_filtered_match_100 <- U2AF2_75_filtered[match(U2AF2_shared_100_75, U2AF2_75_filtered$lsv_id),]

# compare 100 with 50
U2AF2_100_filtered_match_50 <- U2AF2_100_filtered[match(U2AF2_shared_100_50, U2AF2_100_filtered$lsv_id),]

U2AF2_50_filtered_match_100 <- U2AF2_50_filtered[match(U2AF2_shared_100_50, U2AF2_50_filtered$lsv_id),]

# compare 100 with 36
U2AF2_100_filtered_match_36 <- U2AF2_100_filtered[match(U2AF2_shared_100_36, U2AF2_100_filtered$lsv_id),]

U2AF2_36_filtered_match_100 <- U2AF2_36_filtered[match(U2AF2_shared_100_36, U2AF2_36_filtered$lsv_id),]

# compare 75 with 50
U2AF2_75_filtered_match_50 <- U2AF2_75_filtered[match(U2AF2_shared_75_50, U2AF2_75_filtered$lsv_id),]

U2AF2_50_filtered_match_75 <- U2AF2_50_filtered[match(U2AF2_shared_75_50, U2AF2_50_filtered$lsv_id),]

# compare 75 with 36
U2AF2_75_filtered_match_36 <- U2AF2_75_filtered[match(U2AF2_shared_75_36, U2AF2_75_filtered$lsv_id),]

U2AF2_36_filtered_match_75 <- U2AF2_36_filtered[match(U2AF2_shared_75_36, U2AF2_36_filtered$lsv_id),]

# compare 50 with 36
U2AF2_50_filtered_match_36 <- U2AF2_50_filtered[match(U2AF2_shared_50_36, U2AF2_50_filtered$lsv_id),]

U2AF2_36_filtered_match_50 <- U2AF2_36_filtered[match(U2AF2_shared_50_36, U2AF2_36_filtered$lsv_id),]


# extract dpsi value of the first junction for all LSVs
# deltapsi 100 vs 75 
deltaPSI_U2AF2_100_vs_75 = U2AF2_100_filtered_match_75$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

deltaPSI_U2AF2_75_vs_100 = U2AF2_75_filtered_match_100$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 100 vs 50 
deltaPSI_U2AF2_100_vs_50 = U2AF2_100_filtered_match_50$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

deltaPSI_U2AF2_50_vs_100 = U2AF2_50_filtered_match_100$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 100 vs 36 
deltaPSI_U2AF2_100_vs_36 = U2AF2_100_filtered_match_36$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_100 = U2AF2_36_filtered_match_100$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 75 vs 50
deltaPSI_U2AF2_75_vs_50 = U2AF2_75_filtered_match_50$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_50_vs_75 = U2AF2_50_filtered_match_75$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 75 vs 36
deltaPSI_U2AF2_75_vs_36 = U2AF2_75_filtered_match_36$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_75 = U2AF2_36_filtered_match_75$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric

# deltapsi 50 vs 36
deltaPSI_U2AF2_50_vs_36 = U2AF2_50_filtered_match_36$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric                   

deltaPSI_U2AF2_36_vs_50 = U2AF2_36_filtered_match_50$mean_dpsi_per_lsv_junction %>%
  strsplit(split = ";") %>% 
  sapply(FUN = "[[",1) %>% as.numeric'

```

```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
'# build data frame out of vectors with dpsi values 
# create scatter plot with the data frames

# correlation data frame 100 vs 75
U2AF2_correlationDataFrame_100_vs_75 <- data.frame(deltaPSI_U2AF2_100_vs_75, deltaPSI_U2AF2_75_vs_100)

U2AF2_sharedRegulation_scatterPlot1 = ggplot(data=U2AF2_correlationDataFrame_100_vs_75, aes(x=deltaPSI_U2AF2_100_vs_75, deltaPSI_U2AF2_75_vs_100)) +
  ggrastr::geom_point_rast(alpha=0.36) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  #geom_abline(xintercept=0, slope=1, colour="red") +
  geom_smooth(method = "lm") +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  #coord_cartesian(xlim=c(-0.7, 0.7), ylim=c(-0.7, 0.7)) +
  xlab("\u0394\u03A8 100 nt read length") +
  ylab("\u0394\u03A8 75 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 100 vs 50
U2AF2_correlationDataFrame_100_vs_50 <- data.frame(deltaPSI_U2AF2_100_vs_50, deltaPSI_U2AF2_50_vs_100)

U2AF2_sharedRegulation_scatterPlot2 = ggplot(data=U2AF2_correlationDataFrame_100_vs_50, aes(x=deltaPSI_U2AF2_100_vs_50, deltaPSI_U2AF2_50_vs_100)) + 
  ggrastr::geom_point_rast(alpha=0.36) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") + 
  #geom_abline(xintercept=0, slope=1, colour="red") +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  geom_smooth(method = "lm") +
  #coord_cartesian(xlim=c(-0.7, 0.7), ylim=c(-0.7, 0.7)) +
  xlab("\u0394\u03A8 100 nt read length") +
  ylab("\u0394\u03A8 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 100 vs 36
U2AF2_correlationDataFrame_100_vs_36 <- data.frame(deltaPSI_U2AF2_100_vs_36, deltaPSI_U2AF2_36_vs_100)

U2AF2_sharedRegulation_scatterPlot3 = ggplot(data=U2AF2_correlationDataFrame_100_vs_36, aes(x=deltaPSI_U2AF2_100_vs_36, deltaPSI_U2AF2_36_vs_100)) +
  ggrastr::geom_point_rast(alpha=0.36) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  #geom_abline(xintercept=0, slope=1, colour="red") +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  geom_smooth(method = "lm") +
  #coord_cartesian(xlim=c(-0.7, 0.7), ylim=c(-0.7, 0.7)) +
  xlab("\u0394\u03A8 100 nt read length") +
  ylab("\u0394\u03A8 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 75 vs 50
U2AF2_correlationDataFrame_75_vs_50 <- data.frame(deltaPSI_U2AF2_75_vs_50, deltaPSI_U2AF2_50_vs_75)

U2AF2_sharedRegulation_scatterPlot4 = ggplot(data=U2AF2_correlationDataFrame_75_vs_50, aes(x=deltaPSI_U2AF2_75_vs_50, deltaPSI_U2AF2_50_vs_75)) +
  ggrastr::geom_point_rast(alpha=0.36) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  #geom_abline(xintercept=0, slope=1, colour="red") +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  geom_smooth(method = "lm") +
  #coord_cartesian(xlim=c(-0.7, 0.7), ylim=c(-0.7, 0.7)) +
  xlab("\u0394\u03A8 75 nt read length") +
  ylab("\u0394\u03A8 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 75 vs 36
U2AF2_correlationDataFrame_75_vs_36 <- data.frame(deltaPSI_U2AF2_75_vs_36, deltaPSI_U2AF2_36_vs_75)

U2AF2_sharedRegulation_scatterPlot5 = ggplot(data=U2AF2_correlationDataFrame_75_vs_36, aes(x=deltaPSI_U2AF2_75_vs_36, deltaPSI_U2AF2_36_vs_75)) +
  ggrastr::geom_point_rast(alpha=0.36) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  #geom_abline(xintercept=0, slope=1, colour="red") +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  geom_smooth(method = "lm") +
  #coord_cartesian(xlim=c(-0.7, 0.7), ylim=c(-0.7, 0.7)) +
  xlab("\u0394\u03A8 75 nt read length") +
  ylab("\u0394\u03A8 50 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

# correlation data frame 50 vs 36
U2AF2_correlationDataFrame_50_vs_36 <- data.frame(deltaPSI_U2AF2_50_vs_36, deltaPSI_U2AF2_36_vs_50)

U2AF2_sharedRegulation_scatterPlot6 = ggplot(data=U2AF2_correlationDataFrame_50_vs_36, aes(x=deltaPSI_U2AF2_50_vs_36, deltaPSI_U2AF2_36_vs_50)) +
  ggrastr::geom_point_rast(alpha=0.36) +
  geom_hline(yintercept=0, size=.5, linetype="dashed") +
  geom_vline(xintercept=0, size=.5, linetype="dashed") +
  #geom_abline(xintercept=0, slope=1, colour="red") +
  stat_cor(label.x.npc = .3, label.y.npc =1) +
  geom_smooth(method = "lm") +
  #coord_cartesian(xlim=c(-0.7, 0.7), ylim=c(-0.7, 0.7)) +
  xlab("\u0394\u03A8 50 nt read length") +
  ylab("\u0394\u03A8 36 nt read length") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))

U2AF2_sharedRegulation_scatterPlot1
U2AF2_sharedRegulation_scatterPlot2
U2AF2_sharedRegulation_scatterPlot3
U2AF2_sharedRegulation_scatterPlot4
U2AF2_sharedRegulation_scatterPlot5
U2AF2_sharedRegulation_scatterPlot6'


'# save ggplots
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_100_75.pdf", plot = U2AF2_sharedRegulation_scatterPlot1)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_100_50.pdf", plot = U2AF2_sharedRegulation_scatterPlot2)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_100_36.pdf", plot = U2AF2_sharedRegulation_scatterPlot3)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_75_50.pdf", plot = U2AF2_sharedRegulation_scatterPlot4)
ggsave(filename = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/plots/sharedRehulation_50_36.pdf", plot = U2AF2_sharedRegulation_scatterPlot5)'
```

<br>
<br>

## Shared significant binary regulation between the different read length
```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}
# 
# # extract rows with binary significant LSVs
# U2AF2_reads_100_filtered = U2AF2_reads_100[U2AF2_reads_100$nJunctions == 2 &
#                              U2AF2_reads_100$significant == TRUE,]
# U2AF2_reads_75_filtered = U2AF2_reads_75[U2AF2_reads_75$nJunctions == 2 &
#                            U2AF2_reads_75$significant == TRUE,]
# U2AF2_reads_50_filtered = U2AF2_reads_50[U2AF2_reads_50$nJunctions == 2 &
#                            U2AF2_reads_50$significant == TRUE,]
# U2AF2_reads_25_filtered = U2AF2_reads_25[U2AF2_reads_25$nJunctions == 2 &
#                            U2AF2_reads_25$significant == TRUE,]
# 
# # amount of binary significant LSVs 
# dim(U2AF2_reads_100_filtered)
# dim(U2AF2_reads_75_filtered)
# dim(U2AF2_reads_50_filtered)
# dim(U2AF2_reads_100_filtered)
# 
# 
# # extract shared binary significant LSVs for each comparison
# U2AF2_shared_binary_significant_100_75 = intersect(U2AF2_reads_100_filtered$lsv_id, 
#                           U2AF2_reads_75_filtered$lsv_id) 
# length(U2AF2_shared_binary_significant_100_75)
# 
# 
# U2AF2_shared_binary_significant_100_50 = intersect(U2AF2_reads_100_filtered$lsv_id, 
#                           U2AF2_reads_50_filtered$lsv_id) 
# length(U2AF2_shared_binary_significant_100_50)
# 
# 
# U2AF2_shared_binary_significant_100_25 = intersect(U2AF2_reads_100_filtered$lsv_id, 
#                           U2AF2_reads_25_filtered$lsv_id)
# length(U2AF2_shared_binary_significant_100_25)
# 
# 
# # compare 100 with 75 (binary)
# U2AF2_reads_100_filtered_match75 <- U2AF2_reads_100_filtered[match(U2AF2_shared_binary_significant_100_75, U2AF2_reads_100_filtered$lsv_id),]
# 
# U2AF2_reads_75_filtered_match_100 <- U2AF2_reads_75_filtered[match(U2AF2_shared_binary_significant_100_75, U2AF2_reads_75_filtered$lsv_id),]
# 
# # compare 100 with 50 (binary)
# U2AF2_reads_100_filtered_match50 <- U2AF2_reads_100_filtered[match(U2AF2_shared_binary_significant_100_50, U2AF2_reads_100_filtered$lsv_id),]
# 
# U2AF2_reads_50_filtered_match_100 <- U2AF2_reads_50_filtered[match(U2AF2_shared_binary_significant_100_50, U2AF2_reads_50_filtered$lsv_id),]
# 
# # compare 100 with 25 (binary)
# U2AF2_reads_100_filtered_match25 <- U2AF2_reads_100_filtered[match(U2AF2_shared_binary_significant_100_25, U2AF2_reads_100_filtered$lsv_id),]
# 
# U2AF2_reads_25_filtered_match_100 <- U2AF2_reads_25_filtered[match(U2AF2_shared_binary_significant_100_25, U2AF2_reads_25_filtered$lsv_id),]
# 
# 
# # deltapsi 100 matched with 75 (binary)
# deltaPSI_U2AF2_reads_100_match75 = U2AF2_reads_100_filtered_match75$mean_dpsi_per_lsv_junction %>%
# strsplit(split=";") %>% sapply(FUN="[[",1) %>% as.numeric
# 
# deltaPSI_U2AF2_reads_75_match100 = U2AF2_reads_75_filtered_match_100$mean_dpsi_per_lsv_junction %>%
# strsplit(split=";") %>% sapply(FUN="[[",1) %>% as.numeric
# 
# # deltapsi 100 matched with 50 (binary)
# deltaPSI_U2AF2_reads_100_match50 = U2AF2_reads_100_filtered_match50$mean_dpsi_per_lsv_junction %>%
# strsplit(split=";") %>% sapply(FUN="[[",1) %>% as.numeric
# 
# deltaPSI_U2AF2_reads_50_match100 = U2AF2_reads_50_filtered_match_100$mean_dpsi_per_lsv_junction %>%
# strsplit(split=";") %>% sapply(FUN="[[",1) %>% as.numeric
# 
# # deltapsi 100 matched with 25 (binary)
# deltaPSI_U2AF2_reads_100_match25 = U2AF2_reads_100_filtered_match25$mean_dpsi_per_lsv_junction %>%
# strsplit(split=";") %>% sapply(FUN="[[",1) %>% as.numeric
# 
# deltaPSI_U2AF2_reads_25_match100 = U2AF2_reads_25_filtered_match_100$mean_dpsi_per_lsv_junction %>%
# strsplit(split=";") %>% sapply(FUN="[[",1) %>% as.numeric
# 
# 
# # correlation data frame 100 matched with 75
# U2AF2_correlationDataFrame_binary_100_75 <- data.frame(deltaPSI_U2AF2_reads_100_match75, deltaPSI_U2AF2_reads_75_match100)
# 
# U2AF2_sharedBinaryRegulation_scatterPlot1 = ggplot(data=U2AF2_correlationDataFrame_binary_100_75, aes(x=deltaPSI_U2AF2_reads_100_match75, deltaPSI_U2AF2_reads_75_match100)) +
#   geom_point(alpha=0.25) +
#   geom_hline(yintercept=0, size=.5, linetype="dashed") +
#   geom_vline(xintercept=0, size=.5, linetype="dashed") +
#   geom_abline(xintercept=0, slope=1, colour="red") +
#   stat_cor(label.x.npc = .3, label.y.npc =1) +
#   xlab("Delta Psi von 100 nt Read-LÃ¤nge") +
#   ylab("Delta Psi von 75 nt Read-LÃ¤nge") +
#   theme_bw() +
#   theme(plot.title = element_text(face = "bold"))
# 
# # correlation data frame 100 matched with 50
# U2AF2_correlationDataFrame_binary_100_50 <- data.frame(deltaPSI_U2AF2_reads_100_match50, deltaPSI_U2AF2_reads_50_match100)
# 
# U2AF2_sharedBinaryRegulation_scatterPlot2 = ggplot(data=U2AF2_correlationDataFrame_binary_100_50, aes(x=deltaPSI_U2AF2_reads_100_match50, deltaPSI_U2AF2_reads_50_match100)) +
#   geom_point(alpha=0.25) +
#   geom_hline(yintercept=0, size=.5, linetype="dashed") +
#   geom_vline(xintercept=0, size=.5, linetype="dashed") +
#   geom_abline(xintercept=0, slope=1, colour="red") +
#   stat_cor(label.x.npc = .3, label.y.npc =1) +
#   xlab("Delta Psi von 100 nt Read-LÃ¤nge") +
#   ylab("Delta Psi von 50 nt Read-LÃ¤nge") +
#   theme_bw() +
#   theme(plot.title = element_text(face = "bold"))
# 
# # correlation data frame 100 matched with 25
# U2AF2_correlationDataFrame_binary_100_25 <- data.frame(deltaPSI_U2AF2_reads_100_match25, deltaPSI_U2AF2_reads_25_match100)
# 
# U2AF2_sharedBinaryRegulation_scatterPlot3 = ggplot(data=U2AF2_correlationDataFrame_binary_100_25, aes(x=deltaPSI_U2AF2_reads_100_match25, deltaPSI_U2AF2_reads_25_match100)) +
#   geom_point(alpha=0.25) +
#   geom_hline(yintercept=0, size=.5, linetype="dashed") +
#   geom_vline(xintercept=0, size=.5, linetype="dashed") +
#   geom_abline(xintercept=0, slope=1, colour="red") +
#   stat_cor(label.x.npc = .3, label.y.npc =1) +
#   xlab("Delta Psi von 100 nt Read-LÃ¤nge") +
#   ylab("Delta Psi von 25 nt Read-LÃ¤nge") +
#   theme_bw() +
#   theme(plot.title = element_text(face = "bold"))
# 
# 
# U2AF2_sharedBinaryRegulation_scatterPlot1
# U2AF2_sharedBinaryRegulation_scatterPlot2
# U2AF2_sharedBinaryRegulation_scatterPlot3
```


# Influence on the classification of splice events
```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

'# load voila modulize files U2AF2
U2AF2_modDir = "C:/Users/ladwi/OneDrive/Desktop/Freies Studium/05_RStudio/U2AF2/voila modulize files/nicht stringent (Mario)"

U2AF2_modFiles = list.files(path = U2AF2_modDir, pattern = ".tsv")
setwd(U2AF2_modDir)


# list events with 2 Junctions seperately for each read length 
# 2J events: A3SS, A5SS, AFE, ALE, IR
# 4J events: CE
U2AF2_events_2J = lapply(U2AF2_modFiles[1:20], loadFiles)
U2AF2_events_4J = lapply(U2AF2_modFiles[21:24], loadFiles)


# function to filter out significant events with 2 junctions
# significant events (dpsi >= 0.05, probability changing >= 0.9)
filter2JEvents <- function(eventTable) {
  eventTable = eventTable[abs(eventTable$kd.wt_median_dpsi) >= 0.05 & eventTable$kd.wt_probability_changing >= 0.9, ] 
  eventTable %>% group_by(event_id) %>% slice(1)
  }

# function to filter out significant events with 4 junctions
filter4JEvents <- function(eventTable) {
  eventTable %>% 
    group_by(event_id) %>%
    summarise(significant = (((abs(kd.wt_median_dpsi[1]) >= 0.05 & kd.wt_probability_changing[1] >= 0.9) &
    (abs(kd.wt_median_dpsi[2]) >= 0.05 & kd.wt_probability_changing[2] >= 0.9)) |
  ((abs(kd.wt_median_dpsi[3]) >= 0.05 & kd.wt_probability_changing[3] >= 0.9) &
    (abs(kd.wt_median_dpsi[4]) >= 0.05 & kd.wt_probability_changing[4] >= 0.9)))) %>%
    filter(significant == TRUE)
}

# apply filter function to event lists
U2AF2_significantEvents_2J = lapply(U2AF2_events_2J, filter2JEvents)
U2AF2_significantEvents_4J = lapply(U2AF2_events_4J, filter4JEvents)


# name significant events with 2 junctions
names(U2AF2_significantEvents_2J) = c("U2AF2_A3SS_100", "U2AF2_A3SS_75", "U2AF2_A3SS_50", "U2AF2_A3SS_25", 
                                      "U2AF2_A5SS_100", "U2AF2_A5SS_75", "U2AF2_A5SS_50", "U2AF2_A5SS_25", 
                                      "U2AF2_AFE_100", "U2AF2_AFE_75", "U2AF2_AFE_50", "U2AF2_AFE_25", 
                                      "U2AF2_ALE_100", "U2AF2_ALE_75", "U2AF2_ALE_50", "U2AF2_ALE_25", 
                                      "U2AF2_IR_100", "U2AF2_IR_75", "U2AF2_IR_50", "U2AF2_IR_25")

# name significant events with 4 junctions
names(U2AF2_significantEvents_4J) = c("U2AF2_CE_100", "U2AF2_CE_75", "U2AF2_CE_50", "U2AF2_CE_25")


# create data frames with number of event types for each read length
U2AF2_numberOfEventTypes_100_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_100), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_100),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_100), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_100), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_100), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_100)))

U2AF2_numberOfEventTypes_75_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_75), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_75),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_75), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_75), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_75), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_75)))

U2AF2_numberOfEventTypes_50_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_50), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_50),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_50), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_50), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_50), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_50)))

U2AF2_numberOfEventTypes_25_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_25), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_25),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_25), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_25), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_25), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_25)))


# combine event type results of each read length in one data frame
U2AF2_numberOfEventTypes_100_df$readLength = "100"
U2AF2_numberOfEventTypes_75_df$readLength = "075"
U2AF2_numberOfEventTypes_50_df$readLength = "050"
U2AF2_numberOfEventTypes_25_df$readLength = "025"
U2AF2_numberOfEventTypes_df = rbind(U2AF2_numberOfEventTypes_100_df, 
                                    U2AF2_numberOfEventTypes_75_df, 
                                    U2AF2_numberOfEventTypes_50_df, 
                                    U2AF2_numberOfEventTypes_25_df)



# Number of event types for each read length as bar charts
U2AF2_numberOfEventTypes_cols = 
  ggplot(U2AF2_numberOfEventTypes_df, aes(x = event, y = n, fill = readLength)) +
  geom_col(position = "dodge") +
  xlab("Event") +
  ylab("Anzahl Events") +
  scale_fill_manual(values = c("025" = "plum2", "050" = "brown2", "075" = "cyan3", "100" = "midnightblue"), 
                    name = "Read-LÃ¤nge [nt]", 
                    labels = c("25", "50", "75", "100")) +
  ggtitle("U2AF2") +
  theme(plot.title = element_text(face = "bold")) 
 


# fraction of event types for each read length as stacked bar chart 
# amount of events log10 transformed
U2AF2_numberOfEventTypes_StackedBarChart = 
  ggplot(U2AF2_numberOfEventTypes_df, aes(x = readLength, y = n, fill = event)) +
  geom_col(position = "fill") +
  scale_y_log10() +
  xlab("Read-LÃ¤nge [nt]") +
  ylab("Anzahl Events (log10)") +
  scale_x_discrete(labels = c("25", "50", "75", "100")) +
  scale_fill_brewer(palette = "YlGnBu", name = "Event") +
  ggtitle("U2AF2") +
  theme(plot.title = element_text(face = "bold"))


U2AF2_numberOfEventTypes_cols
U2AF2_numberOfEventTypes_StackedBarChart'

```

```{r}
# save plots
# ggsave(filename = "U2AF2_mapping.pdf", plot = U2AF2_StarReport_StackedBarChart)
'ggsave(filename = "U2AF2_nSignficantLSVs_read_depth.pdf", plot = U2AF2_nSignificantLSVs_bar)
ggsave(filename = "sample_size_nSignificantLSVs.pdf", plot = nSignificantLSVs_bar)
ggsave(filename = "U2AF2_ecdf_probs.pdf", plot = ecdf_pVals)'
```


```{r, warning=FALSE,message=FALSE,error=FALSE,fig.keep='all'}

# load voila modulize files U2AF2
U2AF2_modDir = "C:/Users/ladwi/Desktop/HiWi/project_impact_read_length/U2AF2/Modulize/read_length"

U2AF2_modFiles = list.files(path = U2AF2_modDir, pattern = ".tsv")
setwd(U2AF2_modDir)


# list events with 2 Junctions separately for each read length 
# 2J events: A3SS, A5SS, AFE, ALE, IR
# 4J events: CE
U2AF2_events_2J = lapply(U2AF2_modFiles[1:20], loadFiles)
U2AF2_events_4J = lapply(U2AF2_modFiles[21:28], loadFiles)


# function to filter out significant events with 2 junctions
# significant events (dpsi >= 0.05, probability changing >= 0.9)
filter2JEvents <- function(eventTable) {
  eventTable = eventTable[abs(eventTable$colnames(eventTable)[21]) >= 0.05 & eventTable$colnames(eventTable)[22] >= 0.9, ] 
  eventTable %>% group_by(event_id) %>% slice(1)
}


# function to filter out significant events with 4 junctions
filter4JEvents <- function(eventTable) {
  eventTable %>% 
    group_by(event_id) %>%
    summarise(significant = (((abs(colnames(eventTable)[21][1]) >= 0.05 & colnames(eventTable)[22][1] >= 0.9) &
    (abs(colnames(eventTable)[21][2]) >= 0.05 & colnames(eventTable)[22][2] >= 0.9)) |
  ((abs(colnames(eventTable)[21][3]) >= 0.05 & colnames(eventTable)[22][3] >= 0.9) &
    (abs(colnames(eventTable)[21][4]) >= 0.05 & colnames(eventTable)[22][4] >= 0.9)))) %>%
    filter(significant == TRUE)
}

colnames(U2AF2_events_2J[[1]])[22]

# apply filter function to event lists
U2AF2_significantEvents_2J = lapply(U2AF2_events_2J, filter2JEvents)
U2AF2_significantEvents_4J = lapply(U2AF2_events_4J, filter4JEvents)


# name significant events with 2 junctions
names(U2AF2_significantEvents_2J) = c("U2AF2_A3SS_100", "U2AF2_A3SS_75", "U2AF2_A3SS_50", "U2AF2_A3SS_36", 
                                      "U2AF2_A5SS_100", "U2AF2_A5SS_75", "U2AF2_A5SS_50", "U2AF2_A5SS_36", 
                                      "U2AF2_AFE_100", "U2AF2_AFE_75", "U2AF2_AFE_50", "U2AF2_AFE_36", 
                                      "U2AF2_ALE_100", "U2AF2_ALE_75", "U2AF2_ALE_50", "U2AF2_ALE_36", 
                                      "U2AF2_IR_100", "U2AF2_IR_75", "U2AF2_IR_50", "U2AF2_IR_36")

# name significant events with 4 junctions
names(U2AF2_significantEvents_4J) = c("U2AF2_CE_100", "U2AF2_CE_75", "U2AF2_CE_50", "U2AF2_CE_36",
                                      "U2AF2_MEE_100", "U2AF2_MEE_75", "U2AF2_MEE_50", "U2AF2_MEE_36")


# create data frames with number of event types for each read length
U2AF2_numberOfEventTypes_100_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_100), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_100),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_100), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_100), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_100), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_100),
                                             nrow(U2AF2_significantEvents_4J$U2AF2_MEE_100)))

U2AF2_numberOfEventTypes_75_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_75), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_75),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_75), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_75), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_75), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_75),
                                             nrow(U2AF2_significantEvents_4J$U2AF2_MEE_75)))

U2AF2_numberOfEventTypes_50_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_50), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_50),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_50), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_50), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_50), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_50),
                                             nrow(U2AF2_significantEvents_4J$U2AF2_MEE_50)))

U2AF2_numberOfEventTypes_25_df = data.frame(event = c("A3SS", "A5SS", "AFE", "ALE", "IR", "CE"), 
                                       n = c(nrow(U2AF2_significantEvents_2J$U2AF2_A3SS_36), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_A5SS_36),
                                             nrow(U2AF2_significantEvents_2J$U2AF2_AFE_36), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_ALE_36), 
                                             nrow(U2AF2_significantEvents_2J$U2AF2_IR_36), 
                                             nrow(U2AF2_significantEvents_4J$U2AF2_CE_36),
                                             nrow(U2AF2_significantEvents_4J$U2AF2_MEE_36)))


# combine event type results of each read length in one data frame
U2AF2_numberOfEventTypes_100_df$readLength = "100"
U2AF2_numberOfEventTypes_75_df$readLength = "075"
U2AF2_numberOfEventTypes_50_df$readLength = "050"
U2AF2_numberOfEventTypes_36_df$readLength = "036"
U2AF2_numberOfEventTypes_df = rbind(U2AF2_numberOfEventTypes_100_df, 
                                    U2AF2_numberOfEventTypes_75_df, 
                                    U2AF2_numberOfEventTypes_50_df, 
                                    U2AF2_numberOfEventTypes_36_df)



# Number of event types for each read length as bar charts
U2AF2_numberOfEventTypes_cols = 
  ggplot(U2AF2_numberOfEventTypes_df, aes(x = event, y = n, fill = readLength)) +
  geom_col(position = "dodge") +
  xlab("Event") +
  ylab("Anzahl Events") +
  scale_fill_manual(values = c("036" = "plum2", "050" = "brown2", "075" = "cyan3", "100" = "midnightblue"), 
                    name = "Read-LÃ¤nge [nt]", 
                    labels = c("36", "50", "75", "100")) +
  ggtitle("U2AF2") +
  theme(plot.title = element_text(face = "bold")) 
 


# fraction of event types for each read length as stacked bar chart 
# amount of events log10 transformed
U2AF2_numberOfEventTypes_StackedBarChart = 
  ggplot(U2AF2_numberOfEventTypes_df, aes(x = readLength, y = n, fill = event)) +
  geom_col(position = "fill") +
  scale_y_log10() +
  xlab("Read-LÃ¤nge [nt]") +
  ylab("Anzahl Events (log10)") +
  scale_x_discrete(labels = c("35", "50", "75", "100")) +
  scale_fill_brewer(palette = "YlGnBu", name = "Event") +
  ggtitle("U2AF2") +
  theme(plot.title = element_text(face = "bold"))


U2AF2_numberOfEventTypes_cols
U2AF2_numberOfEventTypes_StackedBarChart

U2AF2_events_2J

```

